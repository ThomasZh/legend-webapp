<!DOCTYPE html>
<html class="no-js">

<head>
  <meta charset="utf-8">
  <title>{{ club['name'] }}</title>
  <meta name="description" content="Material Design Mobile Template">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/static/shuttle/img/touch/apple-touch-icon-144x144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/static/shuttle/img/touch/apple-touch-icon-114x114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/static/shuttle/img/touch/apple-touch-icon-72x72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="/static/shuttle/img/touch/apple-touch-icon-57x57-precomposed.png">
  <link rel="shortcut icon" sizes="196x196" href="/static/shuttle/img/touch/touch-icon-196x196.png">
  <link rel="shortcut icon" href="/static/shuttle/img/touch/apple-touch-icon.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="{{ club['img'] }}!200x200">
  <meta name="msapplication-TileColor" content="#222222">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- SEO: If mobile URL is different from desktop URL, add a canonical link to the desktop page -->
  <!--
    <link rel="canonical" href="http://www.example.com/" >
    -->

  <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
  <!--
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="">
    -->

  <!-- Icons -->
  <link href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" media="all" rel="stylesheet" type="text/css">
  <!-- <link href="{{ static_url('shuttle/css/ionicons.min.css') }}" media="all" rel="stylesheet" type="text/css"> -->

  <!-- Stylesheets -->
  <link rel="stylesheet" href="{{ static_url('shuttle/css/animate.css') }}">
  <link rel="stylesheet" href="{{ static_url('shuttle/css/materialize.min.css') }}">
  <link rel="stylesheet" href="{{ static_url('shuttle/css/swipebox.min.css') }}">
  <link rel="stylesheet" href="{{ static_url('shuttle/css/swiper.min.css') }}">
  <link rel="stylesheet" href="{{ static_url('shuttle/css/normalize.css') }}">
  <link rel="stylesheet" href="{{ static_url('shuttle/css/main.css') }}">
  <link rel="stylesheet" href="{{ static_url('weui/lib/weui.min.css') }}">
  <script src="{{ static_url('shuttle/js/vendor/modernizr-2.7.1.min.js') }}"></script>

</head>

<body>

  <!-- Main Container -->
  <div id="main" class="main">

    <!-- Page Contents -->
    <div id="mainForm" class="animated fadeinup">

      <!-- Hero Header -->
      <div class="hero-header hero-big bg-3 animated fadeindown" style="background: url({{ club['img'] }}!700x467) no-repeat center / cover !important;">
        <div class="fixed-action-btn floating-button animated bouncein delay-3 horizontal click-to-toggle">
          <a href="#!" class="btn-floating btn-large accent-color">
            <i class="ion-android-add"></i>
          </a>
          <ul>
            <li><a class="btn-floating red"><i class="ion-ios-heart"></i></a></li>
            <li><a class="btn-floating yellow darken-1"><i class="ion-android-star"></i></a></li>
            <li><a class="btn-floating green"><i class="ion-thumbsup"></i></a></li>
            <li><a href="/wx/clubs/{{ club['_id'] }}/symbols" class="btn-floating blue"><i class="ion-chatbubble-working"></i></a></li>
          </ul>
        </div>
        <div class="hero-author">
          <div class="media-top-object">
            <div class="media-body left-align">
              <p class="white-text">{{ club['name'] }}</p>
              <span class="white-text small"><em>{{ club['phone'] }}</em></span>
              <div class="card-feedback">
                <div class="card-users white-text">
                  <i class="ion-ios-heart accent-text"></i> <span>346</span>
                  <i class="ion-android-person-add"></i> <span>205</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="opacity-overlay-gradient"></div>
      </div>

      <div class="card-feedback">
        <div class="card-users white-text">
          <i class="accent-text"></i> <span>346</span>
          <i class="ion-chatbubble-working"></i> <span>205</span>
        </div>
      </div>

      <!-- uploading toast -->
      {% module Template("wx/block-loading-toast.html") %}
      <!-- /uploading toast -->

      <div id="momentsForm">
        <div is="oneMoment" v-for="(moment, idx) in moments" v-bind:moment="moment" v-bind:idx="idx"></div>

        <!-- load more... -->
        <div class="controls right-align p-20 animated fadeinup delay-2">
          <button id="queryMoreMomentsBtn" class="center" v-on:click="queryMoreMoments">加载更多...</button>
        </div>
      </div>

      <div class="clr"></div>

      <!-- footer -->
      <footer class="page-footer primary-color">
        <div class="footer-copyright">
          <div class="container center">
            <a href="/wx/clubs/{{ club['_id'] }}/index" class="card-users white-text">
              <i class="ion-android-home">{{ club['name'] }}</i>
            </a>
          </div>
        </div>
      </footer>
      <!-- /footer -->

    </div>
    <!-- End of Page Contents -->

  </div>
  <!-- End of Main Container -->

  <!-- Scripts -->
  <script src="{{ static_url('shuttle/js/vendor/jquery-2.1.0.min.js') }}"></script>
  <!-- <script src="{{ static_url('shuttle/js/helper.js') }}"></script> -->
  <script src="{{ static_url('shuttle/js/vendor/HeadsUp.js') }}"></script>
  <!-- <script src="{{ static_url('shuttle/js/vendor/jquery.smoothState.js') }}"></script> -->
  <!-- <script src="{{ static_url('shuttle/js/vendor/chart.min.js') }}"></script> -->
  <script src="{{ static_url('shuttle/js/vendor/jquery.mixitup.min.js') }}"></script>
  <script src="{{ static_url('shuttle/js/vendor/jquery.swipebox.min.js') }}"></script>
  <script src="{{ static_url('shuttle/js/vendor/masonry.min.js') }}"></script>
  <script src="{{ static_url('shuttle/js/vendor/swiper.min.js') }}"></script>
  <script src="{{ static_url('shuttle/js/vendor/materialize.min.js') }}"></script>
  <script src="{{ static_url('shuttle/js/main.js') }}"></script>
  <script src="{{ static_url('js/vue-2.1.4.js') }}" type="text/javascript"></script>

  <script>
    Vue.component('oneImage', {
      template: '\
        <div class="grid-item">\
          <a v-bind:href="imginfo.url_original" class="swipebox no-smoothState" title="">\
            <img v-bind:src="imginfo.url" alt="image">\
          </a>\
        </div>\
      ',
      props: ['idx', 'imginfo'],
    })

    Vue.component('oneMoment', {
      template: '\
      <div class="card fullscreen">\
        <div class="p-20">\
          <div class="grid m-t-20">\
            <div is="oneImage"\
              v-for="(imginfo, idx) in moment.imgs"\
              v-bind:imginfo="imginfo"\
              v-bind:idx="idx"\
            ></div>\
          </div>\
        </div>\
        <div class="card-content">\
          <h5><strong>{{! moment.subtitle }}</strong></h5>\
        </div>\
        <div class="card-author">\
          <div class="media-top-object middle">\
            <img v-bind:src="moment.avatar" alt="" class="media-left avatar small">\
            <div class="media-body">\
              <span class="small">{{! moment.nickname }}\
              <a href="#!" class="accent-text">\
                &nbsp;{{! moment.friendlyTime }}</a>\
              </span>\
            </div>\
          </div>\
        </div>\
        <div class="comments grey lighten-4">\
          <div class="card-facebook">\
            <div class="card-users">\
              <i class="ion-eye"></i> <span>{{! moment.view_num  }}</span>\
              <i class="ion-ios-heart accent-text"></i> <span>{{! moment.like_num  }}</span>\
              <i class="ion-chatbubble-working"></i> <span>{{! moment.comment_num  }}</span>\
            </div>\
            <button class="right" v-bind:id="idx" v-on:click="showComments(idx)">查看详情</button>\
          </div>\
         </div>\
       </div>\
      ',
      props: ['idx', 'moment'],
      methods: {}
    })

    new Vue({
      el: '#mainForm',
      data: {
        moments: [],
        num: 0,
        limit: 8,
      },
      created: function() {
        this.queryMoreMoments();
      },
      methods: {
        queryMoreMoments: function() {
          $('#loadingToast').show();

          _self = this;
          idx = this.num;
          limit = this.limit;

          $.ajax({
            type: "GET",
            url: "http://api.7x24hs.com/api/moments?idx=" + idx + "&limit=" + limit + "&filter=club&club_id={{ club['_id'] }}",
            async: true,
            dataType: "json",
            contentType: 'application/json',
            success: function(datas, status, xhr) {
              console.log(datas);
              for (var i = 0, l = datas.rs.length; i < l; i++) {
                moment = datas.rs[i];
                moment.url = "/wx/clubs/" + moment.club_id + "/moments/" + moment._id;
                imgs = [];
                for (var j = 0, m = moment.imgs.length; j < m; j++) {
                  img = {};
                  img.url = moment.imgs[j] + "!700x467";
                  img.url_original = moment.imgs[j];
                  imgs.push(img);
                }
                moment.imgs = imgs;
                _self.moments.push(moment);
                _self.num += 1;
              }

              if (datas.rs.length < limit) {
                $("#queryMoreMomentsBtn").css('display', 'none');
              }

              $('#loadingToast').hide();

              setTimeout(function() {
                // Masonry
                $('.grid').masonry({
                  itemSelector: '.grid-item'
                });
              }, 1000);
            },
          });
        },
        getFriendlyTime(nS) { //时间戳转换
          return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\d{1,2}$/, ' ');
        },
      }
    })
  </script>

</body>

</html>
\d{1,2}$/, ' '); }, } })
</script>

</body>

</html>
>

</body>

</html>
\d{1,2}$/, ' '); }, } })
</script>

</body>

</html>
